<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.152.2"><meta name=description content><meta name=author content="thienlh@thienlu.com"><link rel=icon href=../../images/favicon.png type=image/png><title>Lambda + API Gateway :: Internship Report</title><link href=../../css/nucleus.css?1765303935 rel=stylesheet><link href=../../css/fontawesome-all.min.css?1765303935 rel=stylesheet><link href=../../css/hybrid.css?1765303935 rel=stylesheet><link href=../../css/featherlight.min.css?1765303935 rel=stylesheet><link href=../../css/perfect-scrollbar.min.css?1765303935 rel=stylesheet><link href=../../css/auto-complete.css?1765303935 rel=stylesheet><link href=../../css/atom-one-dark-reasonable.css?1765303935 rel=stylesheet><link href=../../css/theme.css?1765303935 rel=stylesheet><link href=../../css/hugo-theme.css?1765303935 rel=stylesheet><link href=../../css/theme-workshop.css?1765303935 rel=stylesheet><script src=../../js/jquery-3.3.1.min.js?1765303935></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style></head><body data-url=../../5-workshop/5.4-lambda-api-gateway/><nav id=sidebar class=showVisitedLinks><div id=header-wrapper><div id=header><a id=logo href=../../><svg id="Layer_1" data-name="Layer 1" viewBox="0 0 60 30" width="30%"><defs><style>.cls-1{fill:#fff}.cls-2{fill:#f90;fill-rule:evenodd}</style></defs><title>AWS-Logo_White-Color</title><path class="cls-1" d="M14.09 10.85a4.7 4.7.0 00.19 1.48 7.73 7.73.0 00.54 1.19.77.77.0 01.12.38.64.64.0 01-.32.49l-1 .7a.83.83.0 01-.44.15.69.69.0 01-.49-.23 3.8 3.8.0 01-.6-.77q-.25-.42-.51-1a6.14 6.14.0 01-4.89 2.3 4.54 4.54.0 01-3.32-1.19 4.27 4.27.0 01-1.22-3.2 4.28 4.28.0 011.46-3.4A6.06 6.06.0 017.69 6.46a12.47 12.47.0 011.76.13q.92.13 1.91.36V5.73a3.65 3.65.0 00-.79-2.66A3.81 3.81.0 007.86 2.3a7.71 7.71.0 00-1.79.22 12.78 12.78.0 00-1.79.57 4.55 4.55.0 01-.58.22h-.26q-.35.0-.35-.52V2a1.09 1.09.0 01.12-.58 1.2 1.2.0 01.47-.35A10.88 10.88.0 015.77.32 10.19 10.19.0 018.36.0a6 6 0 014.35 1.35 5.49 5.49.0 011.38 4.09zM7.34 13.38a5.36 5.36.0 001.72-.31A3.63 3.63.0 0010.63 12 2.62 2.62.0 0011.19 11a5.63 5.63.0 00.16-1.44v-.7a14.35 14.35.0 00-1.53-.28 12.37 12.37.0 00-1.56-.1 3.84 3.84.0 00-2.47.67A2.34 2.34.0 005 11a2.35 2.35.0 00.61 1.76A2.4 2.4.0 007.34 13.38zm13.35 1.8a1 1 0 01-.64-.16 1.3 1.3.0 01-.35-.65L15.81 1.51a3 3 0 01-.15-.67.36.36.0 01.41-.41H17.7a1 1 0 01.65.16 1.4 1.4.0 01.33.65l2.79 11 2.59-11A1.17 1.17.0 0124.39.6a1.1 1.1.0 01.67-.16H26.4a1.1 1.1.0 01.67.16 1.17 1.17.0 01.32.65L30 12.39 32.88 1.25A1.39 1.39.0 0133.22.6a1 1 0 01.65-.16h1.54a.36.36.0 01.41.41 1.36 1.36.0 010 .26 3.64 3.64.0 01-.12.41l-4 12.86a1.3 1.3.0 01-.35.65 1 1 0 01-.64.16H29.25a1 1 0 01-.67-.17 1.26 1.26.0 01-.32-.67L25.67 3.64l-2.56 10.7a1.26 1.26.0 01-.32.67 1 1 0 01-.67.17zm21.36.44a11.28 11.28.0 01-2.56-.29 7.44 7.44.0 01-1.92-.67 1 1 0 01-.61-.93v-.84q0-.52.38-.52a.9.9.0 01.31.06l.42.17a8.77 8.77.0 001.83.58 9.78 9.78.0 002 .2 4.48 4.48.0 002.43-.55 1.76 1.76.0 00.86-1.57 1.61 1.61.0 00-.45-1.16A4.29 4.29.0 0043 9.22l-2.41-.76A5.15 5.15.0 0138 6.78a3.94 3.94.0 01-.83-2.41 3.7 3.7.0 01.45-1.85 4.47 4.47.0 011.19-1.37 5.27 5.27.0 011.7-.86A7.4 7.4.0 0142.6.0a8.87 8.87.0 011.12.07q.57.07 1.08.19t.95.26a4.27 4.27.0 01.7.29 1.59 1.59.0 01.49.41.94.94.0 01.15.55v.79q0 .52-.38.52a1.76 1.76.0 01-.64-.2 7.74 7.74.0 00-3.2-.64 4.37 4.37.0 00-2.21.47 1.6 1.6.0 00-.79 1.48 1.58 1.58.0 00.49 1.18 4.94 4.94.0 001.83.92L44.55 7a5.08 5.08.0 012.57 1.6A3.76 3.76.0 0147.9 11a4.21 4.21.0 01-.44 1.93 4.4 4.4.0 01-1.21 1.47 5.43 5.43.0 01-1.85.93A8.25 8.25.0 0142.05 15.62z"/><path class="cls-2" d="M45.19 23.81C39.72 27.85 31.78 30 25 30A36.64 36.64.0 01.22 20.57c-.51-.46-.06-1.09.56-.74A49.78 49.78.0 0025.53 26.4 49.23 49.23.0 0044.4 22.53C45.32 22.14 46.1 23.14 45.19 23.81z"/><path class="cls-2" d="M47.47 21.21c-.7-.9-4.63-.42-6.39-.21-.53.06-.62-.4-.14-.74 3.13-2.2 8.27-1.57 8.86-.83s-.16 5.89-3.09 8.35c-.45.38-.88.18-.68-.32C46.69 25.8 48.17 22.11 47.47 21.21z"/></svg></a></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label>
<input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=../../js/lunr.min.js?1765303935></script><script type=text/javascript src=../../js/auto-complete.js?1765303935></script><script type=text/javascript>var baseurl="/"</script><script type=text/javascript src=../../js/search.js?1765303935></script></div><div class=highlightable><ul class=topics><li data-nav-id=/1-worklog/ title=Worklog class=dd-item><a href=../../1-worklog/><b>1. </b>Worklog
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/1-worklog/1.1-week1/ title="Week 1 Worklog" class=dd-item><a href=../../1-worklog/1.1-week1/><b>1.1. </b>Week 1 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.3-week3/ title="Week 3 Worklog" class=dd-item><a href=../../1-worklog/1.3-week3/><b>1.3. </b>Week 3 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.4-week4/ title="Week 4 Worklog" class=dd-item><a href=../../1-worklog/1.4-week4/><b>1.4. </b>Week 4 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.5-week5/ title="Week 5 Worklog" class=dd-item><a href=../../1-worklog/1.5-week5/><b>1.5. </b>Week 5 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.6-week6/ title="Week 6 Worklog" class=dd-item><a href=../../1-worklog/1.6-week6/><b>1.6. </b>Week 6 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.7-week7/ title="Week 7 Worklog" class=dd-item><a href=../../1-worklog/1.7-week7/><b>1.7. </b>Week 7 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.8-week8/ title="Week 8 Worklog" class=dd-item><a href=../../1-worklog/1.8-week8/><b>1.8. </b>Week 8 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.9-week9/ title="Week 9 Worklog" class=dd-item><a href=../../1-worklog/1.9-week9/><b>1.9. </b>Week 9 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.10-week10/ title="Week 10 Worklog" class=dd-item><a href=../../1-worklog/1.10-week10/><b>1.10. </b>Week 10 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.11-week11/ title="Week 11 Worklog" class=dd-item><a href=../../1-worklog/1.11-week11/><b>1.11. </b>Week 11 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.12-week12/ title="Week 12 Worklog" class=dd-item><a href=../../1-worklog/1.12-week12/><b>1.12. </b>Week 12 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.2-week2/ title class=dd-item><a href=../../1-worklog/1.2-week2/><i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/2-proposal/ title="Proposal 2HTD-LearningHub" class=dd-item><a href=../../2-proposal/><b>2. </b>Proposal
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/3-blogstranslated/ title="Translated Blogs" class=dd-item><a href=../../3-blogstranslated/><b>3. </b>Translated Blogs
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/3-blogstranslated/3.1-blog1/ title="Blog 1" class=dd-item><a href=../../3-blogstranslated/3.1-blog1/><b>3.1. </b>Blog 1
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/3-blogstranslated/3.2-blog2/ title="Blog 2" class=dd-item><a href=../../3-blogstranslated/3.2-blog2/><b>3.2. </b>Blog 2
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/3-blogstranslated/3.3-blog3/ title="Blog 3" class=dd-item><a href=../../3-blogstranslated/3.3-blog3/><b>3.3. </b>Blog 3
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/4-eventparticipated/ title="Events Participated" class=dd-item><a href=../../4-eventparticipated/><b>4. </b>Events Participated
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/4-eventparticipated/4.2-event2/ title="Event 2" class=dd-item><a href=../../4-eventparticipated/4.2-event2/><b>4.2. </b>Event 2
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/4-eventparticipated/4.1-event1/ title class=dd-item><a href=../../4-eventparticipated/4.1-event1/><i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/5-workshop/ title=Workshop class="dd-item
parent"><a href=../../5-workshop/><b>5. </b>Workshop
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/5-workshop/5.1-workshop-overview/ title=Introduction class=dd-item><a href=../../5-workshop/5.1-workshop-overview/><b>5.1. </b>Introduction
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/5-workshop/5.2-prerequiste/ title=Prerequiste class=dd-item><a href=../../5-workshop/5.2-prerequiste/><b>5.2. </b>Prerequiste
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/5-workshop/5.3-cognito-api-gateway/ title="Cognito + API Gateway" class=dd-item><a href=../../5-workshop/5.3-cognito-api-gateway/><b>5.3. </b>Cognito + API Gateway
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/5-workshop/5.3-cognito-api-gateway/5.3.1-create-andconfigue-cognito/ title="Create and configure Cognito & API Gateway" class=dd-item><a href=../../5-workshop/5.3-cognito-api-gateway/5.3.1-create-andconfigue-cognito/>Create and configure Cognito & API Gateway
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/5-workshop/5.4-lambda-api-gateway/ title="Lambda + API Gateway" class="dd-item
active"><a href=../../5-workshop/5.4-lambda-api-gateway/><b>5.4. </b>Lambda + API Gateway
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/5-workshop/5.5-ec2-privatesubnet/ title="EC2 (Private Subnet) — Windows + SQL Server" class=dd-item><a href=../../5-workshop/5.5-ec2-privatesubnet/><b>5.5. </b>EC2 (Private Subnet) — Windows + SQL Server
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/5-workshop/5.6-cleanup/ title="Clean up" class=dd-item><a href=../../5-workshop/5.6-cleanup/><b>5.6. </b>Clean up
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/6-self-evaluation/ title=Self-Assessment class=dd-item><a href=../../6-self-evaluation/><b>6. </b>Self-Assessment
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/7-feedback/ title="Sharing and Feedback" class=dd-item><a href=../../7-feedback/><b>7. </b>Sharing and Feedback
<i class="fas fa-check read-icon"></i></a></li></ul><section id=shortcuts><h3>More</h3><ul><li><a class=padding href=https://www.facebook.com/groups/awsstudygroupfcj/><i class='fab fa-facebook'></i> AWS Study Group</a></li></ul></section><section id=prefooter><hr><ul><li><a class=padding><i class="fas fa-language fa-fw"></i><div class=select-style><select id=select-language onchange="location=this.value"><option id=en value=/5-workshop/5.4-lambda-api-gateway/ selected>English</option><option id=vi value=/vi/5-workshop/5.4-lambda-api-gateway/>Tiếng Việt</option></select>
<svg id="Capa_1" xmlns:xlink="http://www.w3.org/1999/xlink" width="255" height="255" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255"><g><g id="arrow-drop-down"><polygon points="0,63.75 127.5,191.25 255,63.75"/></g></g></svg></div></a></li><li><a class=padding href=# data-clear-history-toggle><i class="fas fa-history fa-fw"></i> Clear History</a></li></ul></section><section id=footer><left><b>Workshop</b><br><img src="https://hitwebcounter.com/counter/counter.php?page=7920860&style=0038&nbdigits=9&type=page&initCount=0" title=Migrate alt="web counter" border=0></a><br><b><a href=https://cloudjourney.awsstudygroup.com/>Cloud Journey</a></b><br><img src="https://hitwebcounter.com/counter/counter.php?page=7830807&style=0038&nbdigits=9&type=page&initCount=0" title="Total CLoud Journey" alt="web counter" border=0>
</left><left><br><br><b>Last Updated</b><br><i><span id=lastUpdated style=color:orange></span>
</i><script>const today=new Date,formattedDate=today.toLocaleDateString("en-GB");document.getElementById("lastUpdated").textContent=formattedDate</script></left><left><br><br><b>Team</b><br><i><a href=https://www.facebook.com/groups/660548818043427 style=color:orange>First Cloud Journey</a><br></i></left><script async defer src=https://buttons.github.io/buttons.js></script></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i>
</a></span><span id=toc-menu><i class="fas fa-list-alt"></i></span>
<span class=links><a href=../../>Internship Report</a> > <a href=../../5-workshop/>Workshop</a> > Lambda + API Gateway</span></div><div class=progress><div class=wrapper><nav id=TableOfContents></nav></div></div></div></div><div id=head-tags></div><div id=body-inner><h1>Lambda + API Gateway</h1><p>Overview</p><p>This lab demonstrates how to build and deploy Lambda-backed HTTP APIs using Amazon API Gateway (HTTP API). Students will create a production-representative Lambda service (Node.js), integrate it with HTTP API routes, configure networking so Lambda can access an EC2-hosted SQL Server in a private subnet, secure credentials with Secrets Manager, and add observability (CloudWatch + X-Ray). The lab also covers IAM roles, CORS, payload format versions, cold-start considerations and deployment examples using AWS CLI / PowerShell.</p><p>Prerequisites</p><ul><li>AWS account with permission to create Lambda, API Gateway, IAM roles, CloudWatch, VPC resources and Secrets Manager.</li><li>AWS CLI v2 (or PowerShell configured) and optional SAM/Serverless framework for local testing.</li><li>Node.js (LTS) for function development and bundling.</li></ul><p>Architecture notes</p><ul><li>Frontend (Vercel) calls API Gateway (HTTP API) endpoints.</li><li>API Gateway routes requests to Lambda functions (Node.js). When Lambdas need to access SQL Server on EC2 (private subnet), configure Lambda to run in the same VPC subnets and allow network access via Security Groups and SSM if needed.</li><li>Credentials (DB user/password) are stored in Secrets Manager; Lambda retrieves them at runtime (with IAM permission <code>secretsmanager:GetSecretValue</code>).</li></ul><p>Detailed steps</p><ol><li>Prepare Lambda execution role (IAM)</li></ol><ul><li>Create a role with a trust policy for Lambda and attach the following minimal managed policies or inline policies:</li></ul><p>Example trust policy (lambda assume role):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>   <span style=color:#f92672>&#34;Version&#34;</span>: <span style=color:#e6db74>&#34;2012-10-17&#34;</span>,
</span></span><span style=display:flex><span>   <span style=color:#f92672>&#34;Statement&#34;</span>: [
</span></span><span style=display:flex><span>      {
</span></span><span style=display:flex><span>         <span style=color:#f92672>&#34;Effect&#34;</span>: <span style=color:#e6db74>&#34;Allow&#34;</span>,
</span></span><span style=display:flex><span>         <span style=color:#f92672>&#34;Principal&#34;</span>: {<span style=color:#f92672>&#34;Service&#34;</span>: <span style=color:#e6db74>&#34;lambda.amazonaws.com&#34;</span>},
</span></span><span style=display:flex><span>         <span style=color:#f92672>&#34;Action&#34;</span>: <span style=color:#e6db74>&#34;sts:AssumeRole&#34;</span>
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>   ]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Attach policies (examples):</p><ul><li><code>AWSLambdaBasicExecutionRole</code> (CloudWatch Logs)</li><li>Inline policy for Secrets Manager + ENI/VPC actions (example):</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>   <span style=color:#f92672>&#34;Version&#34;</span>: <span style=color:#e6db74>&#34;2012-10-17&#34;</span>,
</span></span><span style=display:flex><span>   <span style=color:#f92672>&#34;Statement&#34;</span>: [
</span></span><span style=display:flex><span>      {<span style=color:#f92672>&#34;Effect&#34;</span>:<span style=color:#e6db74>&#34;Allow&#34;</span>,<span style=color:#f92672>&#34;Action&#34;</span>:[<span style=color:#e6db74>&#34;secretsmanager:GetSecretValue&#34;</span>,<span style=color:#e6db74>&#34;secretsmanager:DescribeSecret&#34;</span>],<span style=color:#f92672>&#34;Resource&#34;</span>:<span style=color:#e6db74>&#34;arn:aws:secretsmanager:&lt;region&gt;:&lt;account-id&gt;:secret:&lt;your-secret&gt;&#34;</span>},
</span></span><span style=display:flex><span>      {<span style=color:#f92672>&#34;Effect&#34;</span>:<span style=color:#e6db74>&#34;Allow&#34;</span>,<span style=color:#f92672>&#34;Action&#34;</span>:[<span style=color:#e6db74>&#34;ec2:CreateNetworkInterface&#34;</span>,<span style=color:#e6db74>&#34;ec2:DescribeNetworkInterfaces&#34;</span>,<span style=color:#e6db74>&#34;ec2:DeleteNetworkInterface&#34;</span>],<span style=color:#f92672>&#34;Resource&#34;</span>:<span style=color:#e6db74>&#34;*&#34;</span>}
</span></span><span style=display:flex><span>   ]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>PowerShell / AWS CLI example to create role and attach policy (PowerShell):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#75715e># create role</span>
</span></span><span style=display:flex><span>$trust = <span style=color:#e6db74>&#39;{&#34;Version&#34;:&#34;2012-10-17&#34;,&#34;Statement&#34;:[{&#34;Effect&#34;:&#34;Allow&#34;,&#34;Principal&#34;:{&#34;Service&#34;:&#34;lambda.amazonaws.com&#34;},&#34;Action&#34;:&#34;sts:AssumeRole&#34;}]}&#39;</span>
</span></span><span style=display:flex><span>aws iam create-role --role-name LearningHubLambdaRole --assume-role-policy-document $trust
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># attach managed policy</span>
</span></span><span style=display:flex><span>aws iam attach-role-policy --role-name LearningHubLambdaRole --policy-arn arn<span style=color:#960050;background-color:#1e0010>:</span>aws<span style=color:#960050;background-color:#1e0010>:</span>iam::aws<span style=color:#960050;background-color:#1e0010>:</span>policy/service-role/AWSLambdaBasicExecutionRole
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># put inline policy for secrets + ENI</span>
</span></span><span style=display:flex><span><span style=color:#75715e># save the inline JSON to lambda-secrets-policy.json locally then run:</span>
</span></span><span style=display:flex><span>aws iam put-role-policy --role-name LearningHubLambdaRole --policy-name LambdaSecretsPolicy --policy-document file<span style=color:#960050;background-color:#1e0010>:</span>//lambda-secrets-policy.json
</span></span></code></pre></div><ol start=2><li>Build and package Lambda (Node.js)</li></ol><ul><li><p>Project layout (example):</p><p>lambda/
package.json
index.js
node_modules/</p></li><li><p>Use a bundler (esbuild/webpack) or <code>npm install --production</code> and zip the folder.</p></li></ul><p>PowerShell example to package:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>cd lambda
</span></span><span style=display:flex><span>npm install --production
</span></span><span style=display:flex><span>Compress-Archive -Path * -DestinationPath ..\lambda-package.zip
</span></span></code></pre></div><ol start=3><li>Create Lambda function (CLI)</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>aws lambda create-function --function-name learninghub-api-handler \
</span></span><span style=display:flex><span>   --runtime nodejs18.x --handler index.handler \
</span></span><span style=display:flex><span>   --zip<span style=color:#f92672>-file</span> fileb<span style=color:#960050;background-color:#1e0010>:</span>//lambda-package.zip \
</span></span><span style=display:flex><span>   --role arn<span style=color:#960050;background-color:#1e0010>:</span>aws<span style=color:#960050;background-color:#1e0010>:</span>iam::&lt;account-id&gt;<span style=color:#960050;background-color:#1e0010>:</span>role/LearningHubLambdaRole \
</span></span><span style=display:flex><span>   --timeout <span style=color:#ae81ff>30</span> --memory-size <span style=color:#ae81ff>512</span>
</span></span></code></pre></div><p>If Lambda needs DB access in private subnet, update function configuration to include VPC config (subnet IDs + security group IDs):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>aws lambda update-function-configuration --function-name learninghub-api-handler --vpc-config SubnetIds=subnet-aaa,subnet-bbb,SecurityGroupIds=sg-xxxx
</span></span></code></pre></div><p>Notes on VPC:</p><ul><li>When Lambda runs in a VPC it creates ENIs in the subnets; this can increase cold-start time. Keep at least two ENI-capable subnets (private) available.</li><li>If Lambda needs internet access (e.g., to call external APIs), ensure private subnets have a route to a NAT Gateway in a public subnet.</li></ul><ol start=4><li>Store DB credentials in Secrets Manager and grant Lambda access</li></ol><p>Create secret (PowerShell):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>aws secretsmanager create-secret --name learninghub/sqlserver --secret-string <span style=color:#e6db74>&#39;{&#34;username&#34;:&#34;dbuser&#34;,&#34;password&#34;:&#34;P@ssw0rd&#34;,&#34;host&#34;:&#34;10.0.1.10&#34;,&#34;port&#34;:&#34;1433&#34;}&#39;</span>
</span></span></code></pre></div><p>Attach IAM permission (see step 1) so Lambda can <code>GetSecretValue</code> for that secret.</p><ol start=5><li>Create API Gateway (HTTP API) and integrate with Lambda</li></ol><p>Create HTTP API (CLI):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>$api=$(aws apigatewayv2 create-api --name learninghub-api --protocol-type HTTP --output json)
</span></span><span style=display:flex><span>$apiId=(ConvertFrom-Json $api).ApiId
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># create integration to Lambda</span>
</span></span><span style=display:flex><span>$lambdaArn = <span style=color:#e6db74>&#34;arn:aws:lambda:&lt;region&gt;:&lt;account-id&gt;:function:learninghub-api-handler&#34;</span>
</span></span><span style=display:flex><span>$integration=$(aws apigatewayv2 create-integration --api-id $apiId --integration-type AWS_PROXY --integration-uri $lambdaArn --payload-format-version <span style=color:#ae81ff>2.0</span> --output json)
</span></span><span style=display:flex><span>$integrationId=(ConvertFrom-Json $integration).IntegrationId
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># create a route</span>
</span></span><span style=display:flex><span>aws apigatewayv2 create-route --api-id $apiId --route-key <span style=color:#e6db74>&#34;GET /status&#34;</span> --target <span style=color:#e6db74>&#34;integrations/</span>$integrationId<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># add permission so API Gateway can invoke Lambda</span>
</span></span><span style=display:flex><span>aws lambda add-permission --function-name learninghub-api-handler --statement-id apigw-invoke --action lambda<span style=color:#960050;background-color:#1e0010>:</span>InvokeFunction --principal apigateway.amazonaws.com --source-arn arn<span style=color:#960050;background-color:#1e0010>:</span>aws<span style=color:#960050;background-color:#1e0010>:</span>execute-api<span style=color:#960050;background-color:#1e0010>:</span>&lt;region&gt;<span style=color:#960050;background-color:#1e0010>:</span>&lt;account-id&gt;<span style=color:#960050;background-color:#1e0010>:</span>$apiId/*/*
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># deploy</span>
</span></span><span style=display:flex><span>aws apigatewayv2 create-stage --api-id $apiId --stage-name prod --auto-deploy
</span></span></code></pre></div><p>Notes:</p><ul><li>Use <code>payload-format-version</code> 2.0 for HTTP API; event shape differs from REST API.</li><li><code>integration-type AWS_PROXY</code> maps the entire HTTP request to Lambda event.</li></ul><ol start=6><li>Configure CORS (HTTP API)</li></ol><p>You can enable CORS in console or with CLI using <code>update-api</code> to set <code>CorsConfiguration</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>$cors=<span style=color:#e6db74>&#39;{&#34;AllowOrigins&#34;:[&#34;https://learninghub.example.com&#34;],&#34;AllowMethods&#34;:[&#34;GET&#34;,&#34;POST&#34;,&#34;OPTIONS&#34;],&#34;AllowHeaders&#34;:[&#34;Content-Type&#34;,&#34;Authorization&#34;],&#34;MaxAge&#34;:3600}&#39;</span>
</span></span><span style=display:flex><span>aws apigatewayv2 update-api --api-id $apiId --cors-configuration $cors
</span></span></code></pre></div><ol start=7><li>Test the endpoint</li></ol><p>PowerShell example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>Invoke-RestMethod -Method Get -Uri <span style=color:#e6db74>&#34;https://</span>$apiId<span style=color:#e6db74>.execute-api.&lt;region&gt;.amazonaws.com/status&#34;</span>
</span></span></code></pre></div><p>If your route is protected (e.g., by Cognito authorizer) attach token header: <code>-Headers @{ Authorization = "Bearer $token" }</code>.</p><ol start=8><li>Observability & best practices</li></ol><ul><li>CloudWatch Logs: set log retention, enable structured logging (JSON) from Lambda.</li><li>X-Ray: enable active tracing on the Lambda function for distributed tracing.</li><li>Metrics & Alarms: create alarms for Errors, Throttles, Duration.</li><li>API access logs: configure stage-level access logging for HTTP API via <code>accessLogSettings</code> in <code>create-stage</code>/<code>update-stage</code>.</li></ul><ol start=9><li>Security</li></ol><ul><li>Use Secrets Manager for DB credentials; avoid environment variables with plaintext secrets.</li><li>Scope IAM policies to least privilege and specific ARNs when possible.</li><li>When running Lambda in VPC, ensure security group rules allow outbound to the DB (port 1433) and inbound rules on the DB EC2 allow only Lambda SGs.</li></ul><ol start=10><li>Cleanup</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#75715e># delete stage and API</span>
</span></span><span style=display:flex><span>aws apigatewayv2 delete-api --api-id $apiId
</span></span><span style=display:flex><span><span style=color:#75715e># delete lambda</span>
</span></span><span style=display:flex><span>aws lambda delete-function --function-name learninghub-api-handler
</span></span><span style=display:flex><span><span style=color:#75715e># delete role inline policy, detach managed, then delete role</span>
</span></span><span style=display:flex><span>aws iam delete-role-policy --role-name LearningHubLambdaRole --policy-name LambdaSecretsPolicy
</span></span><span style=display:flex><span>aws iam detach-role-policy --role-name LearningHubLambdaRole --policy-arn arn<span style=color:#960050;background-color:#1e0010>:</span>aws<span style=color:#960050;background-color:#1e0010>:</span>iam::aws<span style=color:#960050;background-color:#1e0010>:</span>policy/service-role/AWSLambdaBasicExecutionRole
</span></span><span style=display:flex><span>aws iam delete-role --role-name LearningHubLambdaRole
</span></span></code></pre></div><p>Appendix: sample minimal Lambda (Node.js)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>// index.js
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>sql</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;mssql&#39;</span>); <span style=color:#75715e>// if using mssql package
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>exports</span>.<span style=color:#a6e22e>handler</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>async</span> (<span style=color:#a6e22e>event</span>) =&gt; {
</span></span><span style=display:flex><span>   <span style=color:#75715e>// parse request, read secret, connect to SQL Server, run query
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>   <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>statusCode</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>200</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>headers</span><span style=color:#f92672>:</span> { <span style=color:#e6db74>&#39;Content-Type&#39;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;application/json&#39;</span> },
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>body</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>stringify</span>({ <span style=color:#a6e22e>message</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;OK&#39;</span>, <span style=color:#a6e22e>request</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>event</span> })
</span></span><span style=display:flex><span>   };
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p>References</p><ul><li>AWS Lambda Developer Guide</li><li>Amazon API Gateway (HTTP API) Developer Guide</li><li>AWS Secrets Manager Developer Guide</li></ul><footer class=footline></footer></div></div><div id=navigation><a class="nav nav-prev" href=../../5-workshop/5.3-cognito-api-gateway/5.3.1-create-andconfigue-cognito/ title="Create and configure Cognito & API Gateway"><i class="fa fa-chevron-left"></i></a>
<a class="nav nav-next" href=../../5-workshop/5.5-ec2-privatesubnet/ title="EC2 (Private Subnet) — Windows + SQL Server" style=margin-right:0><i class="fa fa-chevron-right"></i></a></div></section><div style=left:-1e3px;overflow:scroll;position:absolute;top:-1e3px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=../../js/clipboard.min.js?1765303935></script><script src=../../js/perfect-scrollbar.min.js?1765303935></script><script src=../../js/perfect-scrollbar.jquery.min.js?1765303935></script><script src=../../js/jquery.sticky.js?1765303935></script><script src=../../js/featherlight.min.js?1765303935></script><script src=../../js/highlight.pack.js?1765303935></script><script>hljs.initHighlightingOnLoad()</script><script src=../../js/modernizr.custom-3.6.0.js?1765303935></script><script src=../../js/learn.js?1765303935></script><script src=../../js/hugo-learn.js?1765303935></script><link href=../../mermaid/mermaid.css?1765303935 rel=stylesheet><script src=../../mermaid/mermaid.js?1765303935></script><script>mermaid.initialize({startOnLoad:!0})</script><script>(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,(e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date),(i=t.createElement(n),a=t.getElementsByTagName(n)[0]),i.async=1,i.src=s,a.parentNode.insertBefore(i,a)})(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-158079754-2","auto"),ga("send","pageview")</script></body></html>