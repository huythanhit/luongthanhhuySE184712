<!doctype html><html lang=vi class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.152.2"><meta name=description content><meta name=author content="thienlh@thienlu.com"><link rel=icon href=../../../images/favicon.png type=image/png><title>Lambda + API Gateway :: Báo cáo thực tập</title><link href=../../../css/nucleus.css?1765303936 rel=stylesheet><link href=../../../css/fontawesome-all.min.css?1765303936 rel=stylesheet><link href=../../../css/hybrid.css?1765303936 rel=stylesheet><link href=../../../css/featherlight.min.css?1765303936 rel=stylesheet><link href=../../../css/perfect-scrollbar.min.css?1765303936 rel=stylesheet><link href=../../../css/auto-complete.css?1765303936 rel=stylesheet><link href=../../../css/atom-one-dark-reasonable.css?1765303936 rel=stylesheet><link href=../../../css/theme.css?1765303936 rel=stylesheet><link href=../../../css/hugo-theme.css?1765303936 rel=stylesheet><link href=../../../css/theme-workshop.css?1765303936 rel=stylesheet><script src=../../../js/jquery-3.3.1.min.js?1765303936></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style></head><body data-url=../../../vi/5-workshop/5.4-lambda-api-gateway/><nav id=sidebar class=showVisitedLinks><div id=header-wrapper><div id=header><a id=logo href=../../../><svg id="Layer_1" data-name="Layer 1" viewBox="0 0 60 30" width="30%"><defs><style>.cls-1{fill:#fff}.cls-2{fill:#f90;fill-rule:evenodd}</style></defs><title>AWS-Logo_White-Color</title><path class="cls-1" d="M14.09 10.85a4.7 4.7.0 00.19 1.48 7.73 7.73.0 00.54 1.19.77.77.0 01.12.38.64.64.0 01-.32.49l-1 .7a.83.83.0 01-.44.15.69.69.0 01-.49-.23 3.8 3.8.0 01-.6-.77q-.25-.42-.51-1a6.14 6.14.0 01-4.89 2.3 4.54 4.54.0 01-3.32-1.19 4.27 4.27.0 01-1.22-3.2 4.28 4.28.0 011.46-3.4A6.06 6.06.0 017.69 6.46a12.47 12.47.0 011.76.13q.92.13 1.91.36V5.73a3.65 3.65.0 00-.79-2.66A3.81 3.81.0 007.86 2.3a7.71 7.71.0 00-1.79.22 12.78 12.78.0 00-1.79.57 4.55 4.55.0 01-.58.22h-.26q-.35.0-.35-.52V2a1.09 1.09.0 01.12-.58 1.2 1.2.0 01.47-.35A10.88 10.88.0 015.77.32 10.19 10.19.0 018.36.0a6 6 0 014.35 1.35 5.49 5.49.0 011.38 4.09zM7.34 13.38a5.36 5.36.0 001.72-.31A3.63 3.63.0 0010.63 12 2.62 2.62.0 0011.19 11a5.63 5.63.0 00.16-1.44v-.7a14.35 14.35.0 00-1.53-.28 12.37 12.37.0 00-1.56-.1 3.84 3.84.0 00-2.47.67A2.34 2.34.0 005 11a2.35 2.35.0 00.61 1.76A2.4 2.4.0 007.34 13.38zm13.35 1.8a1 1 0 01-.64-.16 1.3 1.3.0 01-.35-.65L15.81 1.51a3 3 0 01-.15-.67.36.36.0 01.41-.41H17.7a1 1 0 01.65.16 1.4 1.4.0 01.33.65l2.79 11 2.59-11A1.17 1.17.0 0124.39.6a1.1 1.1.0 01.67-.16H26.4a1.1 1.1.0 01.67.16 1.17 1.17.0 01.32.65L30 12.39 32.88 1.25A1.39 1.39.0 0133.22.6a1 1 0 01.65-.16h1.54a.36.36.0 01.41.41 1.36 1.36.0 010 .26 3.64 3.64.0 01-.12.41l-4 12.86a1.3 1.3.0 01-.35.65 1 1 0 01-.64.16H29.25a1 1 0 01-.67-.17 1.26 1.26.0 01-.32-.67L25.67 3.64l-2.56 10.7a1.26 1.26.0 01-.32.67 1 1 0 01-.67.17zm21.36.44a11.28 11.28.0 01-2.56-.29 7.44 7.44.0 01-1.92-.67 1 1 0 01-.61-.93v-.84q0-.52.38-.52a.9.9.0 01.31.06l.42.17a8.77 8.77.0 001.83.58 9.78 9.78.0 002 .2 4.48 4.48.0 002.43-.55 1.76 1.76.0 00.86-1.57 1.61 1.61.0 00-.45-1.16A4.29 4.29.0 0043 9.22l-2.41-.76A5.15 5.15.0 0138 6.78a3.94 3.94.0 01-.83-2.41 3.7 3.7.0 01.45-1.85 4.47 4.47.0 011.19-1.37 5.27 5.27.0 011.7-.86A7.4 7.4.0 0142.6.0a8.87 8.87.0 011.12.07q.57.07 1.08.19t.95.26a4.27 4.27.0 01.7.29 1.59 1.59.0 01.49.41.94.94.0 01.15.55v.79q0 .52-.38.52a1.76 1.76.0 01-.64-.2 7.74 7.74.0 00-3.2-.64 4.37 4.37.0 00-2.21.47 1.6 1.6.0 00-.79 1.48 1.58 1.58.0 00.49 1.18 4.94 4.94.0 001.83.92L44.55 7a5.08 5.08.0 012.57 1.6A3.76 3.76.0 0147.9 11a4.21 4.21.0 01-.44 1.93 4.4 4.4.0 01-1.21 1.47 5.43 5.43.0 01-1.85.93A8.25 8.25.0 0142.05 15.62z"/><path class="cls-2" d="M45.19 23.81C39.72 27.85 31.78 30 25 30A36.64 36.64.0 01.22 20.57c-.51-.46-.06-1.09.56-.74A49.78 49.78.0 0025.53 26.4 49.23 49.23.0 0044.4 22.53C45.32 22.14 46.1 23.14 45.19 23.81z"/><path class="cls-2" d="M47.47 21.21c-.7-.9-4.63-.42-6.39-.21-.53.06-.62-.4-.14-.74 3.13-2.2 8.27-1.57 8.86-.83s-.16 5.89-3.09 8.35c-.45.38-.88.18-.68-.32C46.69 25.8 48.17 22.11 47.47 21.21z"/></svg></a></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label>
<input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=../../../js/lunr.min.js?1765303936></script><script type=text/javascript src=../../../js/auto-complete.js?1765303936></script><script type=text/javascript>var baseurl="//vi"</script><script type=text/javascript src=../../../js/search.js?1765303936></script></div><div class=highlightable><ul class=topics><li data-nav-id=/vi/1-worklog/ title="Nhật ký công việc" class=dd-item><a href=../../../vi/1-worklog/><b>1. </b>Nhật ký công việc
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/vi/1-worklog/1.1-week1/ title="Worklog Tuần 1" class=dd-item><a href=../../../vi/1-worklog/1.1-week1/><b>1.1. </b>Worklog Tuần 1
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.2-week2/ title="Worklog Tuần 2" class=dd-item><a href=../../../vi/1-worklog/1.2-week2/><b>1.2. </b>Worklog Tuần 2
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.3-week3/ title="Worklog Tuần 3" class=dd-item><a href=../../../vi/1-worklog/1.3-week3/><b>1.3. </b>Worklog Tuần 3
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.4-week4/ title="Worklog Tuần 4" class=dd-item><a href=../../../vi/1-worklog/1.4-week4/><b>1.4. </b>Worklog Tuần 4
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.5-week5/ title="Worklog Tuần 5" class=dd-item><a href=../../../vi/1-worklog/1.5-week5/><b>1.5. </b>Worklog Tuần 5
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.6-week6/ title="Worklog Tuần 6" class=dd-item><a href=../../../vi/1-worklog/1.6-week6/><b>1.6. </b>Worklog Tuần 6
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.7-week7/ title="Worklog Tuần 7" class=dd-item><a href=../../../vi/1-worklog/1.7-week7/><b>1.7. </b>Worklog Tuần 7
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.8-week8/ title="Worklog Tuần 8" class=dd-item><a href=../../../vi/1-worklog/1.8-week8/><b>1.8. </b>Worklog Tuần 8
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.9-week9/ title="Worklog Tuần 9" class=dd-item><a href=../../../vi/1-worklog/1.9-week9/><b>1.9. </b>Worklog Tuần 9
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.10-week10/ title="Worklog Tuần 10" class=dd-item><a href=../../../vi/1-worklog/1.10-week10/><b>1.10. </b>Worklog Tuần 10
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.11-week11/ title="Worklog Tuần 11" class=dd-item><a href=../../../vi/1-worklog/1.11-week11/><b>1.11. </b>Worklog Tuần 11
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.12-week12/ title="Worklog Tuần 12" class=dd-item><a href=../../../vi/1-worklog/1.12-week12/><b>1.12 </b>Worklog Tuần 12
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/vi/2-proposal/ title="Proposal 2HTD-LearningHub" class=dd-item><a href=../../../vi/2-proposal/><b>2. </b>Proposal
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/3-blogstranslated/ title="Các bài blogs đã dịch" class=dd-item><a href=../../../vi/3-blogstranslated/><b>3. </b>Các bài blogs đã dịch
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/vi/3-blogstranslated/3.1-blog1/ title="Blog 1" class=dd-item><a href=../../../vi/3-blogstranslated/3.1-blog1/><b>3.1. </b>Blog 1
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/3-blogstranslated/3.2-blog2/ title="Blog 2" class=dd-item><a href=../../../vi/3-blogstranslated/3.2-blog2/><b>3.2. </b>Blog 2
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/3-blogstranslated/3.3-blog3/ title="Blog 3" class=dd-item><a href=../../../vi/3-blogstranslated/3.3-blog3/><b>3.3. </b>Blog 3
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/vi/4-eventparticipated/ title="Các events đã tham gia" class=dd-item><a href=../../../vi/4-eventparticipated/><b>4. </b>Các events đã tham gia
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/vi/4-eventparticipated/4.1-event1/ title="Event 1" class=dd-item><a href=../../../vi/4-eventparticipated/4.1-event1/><b>4.1. </b>Event 1
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/4-eventparticipated/4.2-event2/ title="Event 2" class=dd-item><a href=../../../vi/4-eventparticipated/4.2-event2/><b>4.2. </b>Event 2
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/vi/5-workshop/ title=Workshop class="dd-item
parent"><a href=../../../vi/5-workshop/><b>5. </b>Workshop
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/vi/5-workshop/5.1-workshop-overview/ title="Giới thiệu" class=dd-item><a href=../../../vi/5-workshop/5.1-workshop-overview/><b>5.1. </b>Giới thiệu
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/5-workshop/5.3-cognito-api-gateway/ title="Cognito + API Gateway" class=dd-item><a href=../../../vi/5-workshop/5.3-cognito-api-gateway/><b>5.3. </b>Cognito + API Gateway
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/vi/5-workshop/5.3-cognito-api-gateway/5.3.1-create-andconfigue-cognito/ title="Tạo và cấu hình Cognito & API Gateway" class=dd-item><a href=../../../vi/5-workshop/5.3-cognito-api-gateway/5.3.1-create-andconfigue-cognito/><b>5.3.1. </b>Tạo và cấu hình Cognito & API Gateway
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/vi/5-workshop/5.5-ec2-privatesubnet/ title="EC2 (Private Subnet) — Windows + SQL Server" class=dd-item><a href=../../../vi/5-workshop/5.5-ec2-privatesubnet/><b>5.5. </b>EC2 (Private Subnet) — Windows + SQL Server
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/5-workshop/5.4-lambda-api-gateway/ title="Lambda + API Gateway" class="dd-item
active"><a href=../../../vi/5-workshop/5.4-lambda-api-gateway/><b>5.4. </b>Lambda + API Gateway
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/5-workshop/5.6-cleanup/ title="Dọn dẹp tài nguyên" class=dd-item><a href=../../../vi/5-workshop/5.6-cleanup/><b>5.6. </b>Dọn dẹp tài nguyên
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/5-workshop/5.2-prerequiste/ title class=dd-item><a href=../../../vi/5-workshop/5.2-prerequiste/><i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/vi/6-self-evaluation/ title="Tự đánh giá" class=dd-item><a href=../../../vi/6-self-evaluation/><b>6. </b>Tự đánh giá
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/7-feedback/ title="Chia sẻ, đóng góp ý kiến" class=dd-item><a href=../../../vi/7-feedback/><b>7. </b>Chia sẻ, đóng góp ý kiến
<i class="fas fa-check read-icon"></i></a></li></ul><section id=shortcuts><h3>More</h3><ul><li><a class=padding href=https://www.facebook.com/groups/awsstudygroupfcj/><i class='fab fa-facebook'></i> AWS Study Group</a></li></ul></section><section id=prefooter><hr><ul><li><a class=padding><i class="fas fa-language fa-fw"></i><div class=select-style><select id=select-language onchange="location=this.value"><option id=en value=/5-workshop/5.4-lambda-api-gateway/>English</option><option id=vi value=/vi/5-workshop/5.4-lambda-api-gateway/ selected>Tiếng Việt</option></select>
<svg id="Capa_1" xmlns:xlink="http://www.w3.org/1999/xlink" width="255" height="255" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255"><g><g id="arrow-drop-down"><polygon points="0,63.75 127.5,191.25 255,63.75"/></g></g></svg></div></a></li><li><a class=padding href=# data-clear-history-toggle><i class="fas fa-history fa-fw"></i> Clear History</a></li></ul></section><section id=footer><left><b>Workshop</b><br><img src="https://hitwebcounter.com/counter/counter.php?page=7920860&style=0038&nbdigits=9&type=page&initCount=0" title=Migrate alt="web counter" border=0></a><br><b><a href=https://cloudjourney.awsstudygroup.com/>Cloud Journey</a></b><br><img src="https://hitwebcounter.com/counter/counter.php?page=7830807&style=0038&nbdigits=9&type=page&initCount=0" title="Total CLoud Journey" alt="web counter" border=0>
</left><left><br><br><b>Last Updated</b><br><i><span id=lastUpdated style=color:orange></span>
</i><script>const today=new Date,formattedDate=today.toLocaleDateString("en-GB");document.getElementById("lastUpdated").textContent=formattedDate</script></left><left><br><br><b>Team</b><br><i><a href=https://www.facebook.com/groups/660548818043427 style=color:orange>First Cloud Journey</a><br></i></left><script async defer src=https://buttons.github.io/buttons.js></script></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i>
</a></span><span id=toc-menu><i class="fas fa-list-alt"></i></span>
<span class=links><a href=../../../vi/>Báo cáo thực tập</a> > <a href=../../../vi/5-workshop/>Workshop</a> > Lambda + API Gateway</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><a href=#tổng-quan>Tổng quan</a></li><li><a href=#yêu-cầu-trước>Yêu cầu trước</a></li><li><a href=#ghi-chú-kiến-trúc>Ghi chú kiến trúc</a></li><li><a href=#các-bước-chi-tiết>Các bước chi tiết</a></li></ul></nav></div></div></div></div><div id=head-tags></div><div id=body-inner><h1>Lambda + API Gateway</h1><h2 id=tổng-quan>Tổng quan</h2><p>Bài lab này hướng dẫn cách xây dựng và triển khai API HTTP dựa trên Lambda sử dụng Amazon API Gateway (HTTP API). Phiên bản nâng cao này bao gồm các chủ đề: đóng gói hàm Lambda (Node.js), cấu hình IAM tối thiểu, chạy Lambda trong VPC để truy cập SQL Server trên EC2 trong private subnet, lưu giữ thông tin đăng nhập bằng AWS Secrets Manager, cấu hình CORS, và quan sát (CloudWatch + X-Ray). Ngoài ra còn có ví dụ sử dụng AWS CLI / PowerShell để thao tác nhanh.</p><h2 id=yêu-cầu-trước>Yêu cầu trước</h2><ul><li>Tài khoản AWS có quyền tạo Lambda, API Gateway, IAM, CloudWatch, VPC/subnet, Security Group, và Secrets Manager.</li><li>AWS CLI v2 hoặc PowerShell đã cấu hình; SAM/Serverless tùy chọn cho kiểm thử cục bộ.</li><li>Node.js (phiên bản LTS) để phát triển và đóng gói hàm.</li></ul><h2 id=ghi-chú-kiến-trúc>Ghi chú kiến trúc</h2><ul><li>Frontend (Vercel) gọi API Gateway (HTTP API).</li><li>API Gateway chuyển tiếp request tới Lambda (Node.js). Nếu Lambda cần truy cập SQL Server trên EC2 trong private subnet, cấu hình Lambda chạy trong cùng VPC/subnet và dùng Security Group phù hợp.</li><li>Thông tin nhạy cảm (DB username/password) được lưu trong Secrets Manager; Lambda cần quyền <code>secretsmanager:GetSecretValue</code> để truy xuất khi runtime.</li></ul><h2 id=các-bước-chi-tiết>Các bước chi tiết</h2><ol><li>Chuẩn bị IAM role cho Lambda</li></ol><ul><li>Tạo role có trust policy cho Lambda và gán các policy cần thiết.</li></ul><p>Ví dụ trust policy (cho phép Lambda assume role):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>   <span style=color:#f92672>&#34;Version&#34;</span>: <span style=color:#e6db74>&#34;2012-10-17&#34;</span>,
</span></span><span style=display:flex><span>   <span style=color:#f92672>&#34;Statement&#34;</span>: [
</span></span><span style=display:flex><span>      {
</span></span><span style=display:flex><span>         <span style=color:#f92672>&#34;Effect&#34;</span>: <span style=color:#e6db74>&#34;Allow&#34;</span>,
</span></span><span style=display:flex><span>         <span style=color:#f92672>&#34;Principal&#34;</span>: {<span style=color:#f92672>&#34;Service&#34;</span>: <span style=color:#e6db74>&#34;lambda.amazonaws.com&#34;</span>},
</span></span><span style=display:flex><span>         <span style=color:#f92672>&#34;Action&#34;</span>: <span style=color:#e6db74>&#34;sts:AssumeRole&#34;</span>
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>   ]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li><p>Gán policy mẫu:</p><ul><li><code>AWSLambdaBasicExecutionRole</code> (ghi CloudWatch Logs)</li><li>Policy inline cho phép truy xuất Secrets Manager và hành động ENI (khi Lambda trong VPC):</li></ul></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>   <span style=color:#f92672>&#34;Version&#34;</span>: <span style=color:#e6db74>&#34;2012-10-17&#34;</span>,
</span></span><span style=display:flex><span>   <span style=color:#f92672>&#34;Statement&#34;</span>: [
</span></span><span style=display:flex><span>      {<span style=color:#f92672>&#34;Effect&#34;</span>:<span style=color:#e6db74>&#34;Allow&#34;</span>,<span style=color:#f92672>&#34;Action&#34;</span>:[<span style=color:#e6db74>&#34;secretsmanager:GetSecretValue&#34;</span>,<span style=color:#e6db74>&#34;secretsmanager:DescribeSecret&#34;</span>],<span style=color:#f92672>&#34;Resource&#34;</span>:<span style=color:#e6db74>&#34;arn:aws:secretsmanager:&lt;region&gt;:&lt;account-id&gt;:secret:&lt;your-secret&gt;&#34;</span>},
</span></span><span style=display:flex><span>      {<span style=color:#f92672>&#34;Effect&#34;</span>:<span style=color:#e6db74>&#34;Allow&#34;</span>,<span style=color:#f92672>&#34;Action&#34;</span>:[<span style=color:#e6db74>&#34;ec2:CreateNetworkInterface&#34;</span>,<span style=color:#e6db74>&#34;ec2:DescribeNetworkInterfaces&#34;</span>,<span style=color:#e6db74>&#34;ec2:DeleteNetworkInterface&#34;</span>],<span style=color:#f92672>&#34;Resource&#34;</span>:<span style=color:#e6db74>&#34;*&#34;</span>}
</span></span><span style=display:flex><span>   ]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>PowerShell / AWS CLI để tạo role và gán policy:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#75715e># tạo role</span>
</span></span><span style=display:flex><span>$trust = <span style=color:#e6db74>&#39;{&#34;Version&#34;:&#34;2012-10-17&#34;,&#34;Statement&#34;:[{&#34;Effect&#34;:&#34;Allow&#34;,&#34;Principal&#34;:{&#34;Service&#34;:&#34;lambda.amazonaws.com&#34;},&#34;Action&#34;:&#34;sts:AssumeRole&#34;}]}&#39;</span>
</span></span><span style=display:flex><span>aws iam create-role --role-name LearningHubLambdaRole --assume-role-policy-document $trust
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># gán managed policy</span>
</span></span><span style=display:flex><span>aws iam attach-role-policy --role-name LearningHubLambdaRole --policy-arn arn<span style=color:#960050;background-color:#1e0010>:</span>aws<span style=color:#960050;background-color:#1e0010>:</span>iam::aws<span style=color:#960050;background-color:#1e0010>:</span>policy/service-role/AWSLambdaBasicExecutionRole
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># thêm inline policy (lưu file lambda-secrets-policy.json rồi chạy)</span>
</span></span><span style=display:flex><span>aws iam put-role-policy --role-name LearningHubLambdaRole --policy-name LambdaSecretsPolicy --policy-document file<span style=color:#960050;background-color:#1e0010>:</span>//lambda-secrets-policy.json
</span></span></code></pre></div><ol start=2><li>Đóng gói hàm Lambda (Node.js)</li></ol><ul><li><p>Cấu trúc ví dụ:</p><p>lambda/
package.json
index.js
node_modules/</p></li><li><p>Dùng bundler (esbuild/webpack) hoặc <code>npm install --production</code> rồi nén thành zip.</p></li></ul><p>PowerShell ví dụ:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>cd lambda
</span></span><span style=display:flex><span>npm install --production
</span></span><span style=display:flex><span>Compress-Archive -Path * -DestinationPath ..\lambda-package.zip
</span></span></code></pre></div><ol start=3><li>Tạo hàm Lambda (CLI)</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>aws lambda create-function --function-name learninghub-api-handler \
</span></span><span style=display:flex><span>   --runtime nodejs18.x --handler index.handler \
</span></span><span style=display:flex><span>   --zip<span style=color:#f92672>-file</span> fileb<span style=color:#960050;background-color:#1e0010>:</span>//lambda-package.zip \
</span></span><span style=display:flex><span>   --role arn<span style=color:#960050;background-color:#1e0010>:</span>aws<span style=color:#960050;background-color:#1e0010>:</span>iam::&lt;account-id&gt;<span style=color:#960050;background-color:#1e0010>:</span>role/LearningHubLambdaRole \
</span></span><span style=display:flex><span>   --timeout <span style=color:#ae81ff>30</span> --memory-size <span style=color:#ae81ff>512</span>
</span></span></code></pre></div><p>Nếu Lambda cần truy cập DB trong private subnet, cập nhật cấu hình VPC:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>aws lambda update-function-configuration --function-name learninghub-api-handler --vpc-config SubnetIds=subnet-aaa,subnet-bbb,SecurityGroupIds=sg-xxxx
</span></span></code></pre></div><p>Ghi chú về VPC:</p><ul><li>Lambda khi chạy trong VPC sẽ tạo ENI trong các subnet; điều này làm tăng thời gian cold-start.</li><li>Luôn có ít nhất hai subnet private để Lambda có thể tạo ENI.</li><li>Nếu Lambda cần truy cập Internet, đảm bảo private subnet route đến NAT Gateway.</li></ul><ol start=4><li>Lưu credentials vào Secrets Manager và cấp quyền cho Lambda</li></ol><p>Tạo secret (PowerShell):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>aws secretsmanager create-secret --name learninghub/sqlserver --secret-string <span style=color:#e6db74>&#39;{&#34;username&#34;:&#34;dbuser&#34;,&#34;password&#34;:&#34;P@ssw0rd&#34;,&#34;host&#34;:&#34;10.0.1.10&#34;,&#34;port&#34;:&#34;1433&#34;}&#39;</span>
</span></span></code></pre></div><p>Đảm bảo IAM role của Lambda có quyền <code>secretsmanager:GetSecretValue</code> cho ARN secret tương ứng.</p><ol start=5><li>Tạo API Gateway (HTTP API) và tích hợp với Lambda</li></ol><p>Tạo API (CLI):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>$api=$(aws apigatewayv2 create-api --name learninghub-api --protocol-type HTTP --output json)
</span></span><span style=display:flex><span>$apiId=(ConvertFrom-Json $api).ApiId
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># tạo integration tới Lambda</span>
</span></span><span style=display:flex><span>$lambdaArn = <span style=color:#e6db74>&#34;arn:aws:lambda:&lt;region&gt;:&lt;account-id&gt;:function:learninghub-api-handler&#34;</span>
</span></span><span style=display:flex><span>$integration=$(aws apigatewayv2 create-integration --api-id $apiId --integration-type AWS_PROXY --integration-uri $lambdaArn --payload-format-version <span style=color:#ae81ff>2.0</span> --output json)
</span></span><span style=display:flex><span>$integrationId=(ConvertFrom-Json $integration).IntegrationId
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># tạo route</span>
</span></span><span style=display:flex><span>aws apigatewayv2 create-route --api-id $apiId --route-key <span style=color:#e6db74>&#34;GET /status&#34;</span> --target <span style=color:#e6db74>&#34;integrations/</span>$integrationId<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># cho phép API Gateway invoke Lambda</span>
</span></span><span style=display:flex><span>aws lambda add-permission --function-name learninghub-api-handler --statement-id apigw-invoke --action lambda<span style=color:#960050;background-color:#1e0010>:</span>InvokeFunction --principal apigateway.amazonaws.com --source-arn arn<span style=color:#960050;background-color:#1e0010>:</span>aws<span style=color:#960050;background-color:#1e0010>:</span>execute-api<span style=color:#960050;background-color:#1e0010>:</span>&lt;region&gt;<span style=color:#960050;background-color:#1e0010>:</span>&lt;account-id&gt;<span style=color:#960050;background-color:#1e0010>:</span>$apiId/*/*
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># deploy</span>
</span></span><span style=display:flex><span>aws apigatewayv2 create-stage --api-id $apiId --stage-name prod --auto-deploy
</span></span></code></pre></div><p>Ghi chú:</p><ul><li>Dùng <code>payload-format-version</code> 2.0 cho HTTP API; event gửi đến Lambda có cấu trúc khác so với REST API.</li><li><code>integration-type AWS_PROXY</code> chuyển toàn bộ HTTP request tới Lambda.</li></ul><ol start=6><li>Cấu hình CORS (HTTP API)</li></ol><p>Kích hoạt CORS trong Console hoặc dùng CLI:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>$cors=<span style=color:#e6db74>&#39;{&#34;AllowOrigins&#34;:[&#34;https://learninghub.example.com&#34;],&#34;AllowMethods&#34;:[&#34;GET&#34;,&#34;POST&#34;,&#34;OPTIONS&#34;],&#34;AllowHeaders&#34;:[&#34;Content-Type&#34;,&#34;Authorization&#34;],&#34;MaxAge&#34;:3600}&#39;</span>
</span></span><span style=display:flex><span>aws apigatewayv2 update-api --api-id $apiId --cors-configuration $cors
</span></span></code></pre></div><ol start=7><li>Kiểm thử endpoint</li></ol><p>PowerShell ví dụ:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>Invoke-RestMethod -Method Get -Uri <span style=color:#e6db74>&#34;https://</span>$apiId<span style=color:#e6db74>.execute-api.&lt;region&gt;.amazonaws.com/status&#34;</span>
</span></span></code></pre></div><p>Nếu route được bảo vệ (ví dụ Cognito), thêm header token: <code>-Headers @{ Authorization = "Bearer $token" }</code>.</p><ol start=8><li>Quan sát & thực hành tốt</li></ol><ul><li>CloudWatch Logs: đặt retention, dùng structured logging (JSON).</li><li>X-Ray: bật tracing cho Lambda để theo dõi phân tán.</li><li>Metrics & Alarms: tạo alarm cho Errors, Throttles, Duration.</li><li>API access logs: cấu hình access log cho stage via <code>accessLogSettings</code>.</li></ul><ol start=9><li>Bảo mật</li></ol><ul><li>Dùng Secrets Manager để quản lý mật khẩu DB; tránh lưu plaintext trong biến môi trường.</li><li>Giới hạn IAM policy theo nguyên tắc least privilege (tốt nhất là theo ARN cụ thể).</li><li>Khi Lambda chạy trong VPC, đảm bảo Security Group cho phép outbound tới DB (port 1433) và EC2 DB chỉ cho phép inbound từ SG của Lambda.</li></ul><ol start=10><li>Dọn dẹp</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#75715e># xóa API</span>
</span></span><span style=display:flex><span>aws apigatewayv2 delete-api --api-id $apiId
</span></span><span style=display:flex><span><span style=color:#75715e># xóa lambda</span>
</span></span><span style=display:flex><span>aws lambda delete-function --function-name learninghub-api-handler
</span></span><span style=display:flex><span><span style=color:#75715e># xóa policy inline, detach managed, rồi xóa role</span>
</span></span><span style=display:flex><span>aws iam delete-role-policy --role-name LearningHubLambdaRole --policy-name LambdaSecretsPolicy
</span></span><span style=display:flex><span>aws iam detach-role-policy --role-name LearningHubLambdaRole --policy-arn arn<span style=color:#960050;background-color:#1e0010>:</span>aws<span style=color:#960050;background-color:#1e0010>:</span>iam::aws<span style=color:#960050;background-color:#1e0010>:</span>policy/service-role/AWSLambdaBasicExecutionRole
</span></span><span style=display:flex><span>aws iam delete-role --role-name LearningHubLambdaRole
</span></span></code></pre></div><p>Appendix: ví dụ Lambda minimal (Node.js)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>// index.js
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>sql</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;mssql&#39;</span>); <span style=color:#75715e>// nếu dùng package mssql
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>exports</span>.<span style=color:#a6e22e>handler</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>async</span> (<span style=color:#a6e22e>event</span>) =&gt; {
</span></span><span style=display:flex><span>   <span style=color:#75715e>// parse request, đọc secret, kết nối SQL Server, chạy query
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>   <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>statusCode</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>200</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>headers</span><span style=color:#f92672>:</span> { <span style=color:#e6db74>&#39;Content-Type&#39;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;application/json&#39;</span> },
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>body</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>stringify</span>({ <span style=color:#a6e22e>message</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;OK&#39;</span>, <span style=color:#a6e22e>request</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>event</span> })
</span></span><span style=display:flex><span>   };
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p>Tài liệu tham khảo</p><ul><li>AWS Lambda Developer Guide</li><li>Amazon API Gateway (HTTP API) Developer Guide</li><li>AWS Secrets Manager Developer Guide</li></ul><footer class=footline></footer></div></div><div id=navigation><a class="nav nav-prev" href=../../../vi/5-workshop/5.5-ec2-privatesubnet/ title="EC2 (Private Subnet) — Windows + SQL Server"><i class="fa fa-chevron-left"></i></a>
<a class="nav nav-next" href=../../../vi/5-workshop/5.6-cleanup/ title="Dọn dẹp tài nguyên" style=margin-right:0><i class="fa fa-chevron-right"></i></a></div></section><div style=left:-1e3px;overflow:scroll;position:absolute;top:-1e3px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=../../../js/clipboard.min.js?1765303936></script><script src=../../../js/perfect-scrollbar.min.js?1765303936></script><script src=../../../js/perfect-scrollbar.jquery.min.js?1765303936></script><script src=../../../js/jquery.sticky.js?1765303936></script><script src=../../../js/featherlight.min.js?1765303936></script><script src=../../../js/highlight.pack.js?1765303936></script><script>hljs.initHighlightingOnLoad()</script><script src=../../../js/modernizr.custom-3.6.0.js?1765303936></script><script src=../../../js/learn.js?1765303936></script><script src=../../../js/hugo-learn.js?1765303936></script><link href=../../../mermaid/mermaid.css?1765303936 rel=stylesheet><script src=../../../mermaid/mermaid.js?1765303936></script><script>mermaid.initialize({startOnLoad:!0})</script><script>(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,(e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date),(i=t.createElement(n),a=t.getElementsByTagName(n)[0]),i.async=1,i.src=s,a.parentNode.insertBefore(i,a)})(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-158079754-2","auto"),ga("send","pageview")</script></body></html>